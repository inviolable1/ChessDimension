/*! ChessDimension built on 2013-04-27 by Roger Qiu <roger.qiu@polycademy.com> */
"use strict";var app=angular.module("App",["Controllers","Filters","Services","Directives","ngResource","ngCookies","ui","ui.bootstrap"]);angular.module("Controllers",[]),angular.module("Filters",[]),angular.module("Services",[]),angular.module("Directives",[]),app.config(["$routeProvider","$locationProvider","UsersServProvider",function(e,t,n){n.setLoginPage="/auth",t.html5Mode(!0).hashPrefix("!"),e.when("/",{templateUrl:"home_index.html",controller:"HomeIndexCtrl"}).when("/auth",{templateUrl:"auth_index.html",controller:"AuthIndexCtrl"}).when("/courses",{templateUrl:"courses_index.html",controller:"CoursesIndexCtrl"}).when("/canvas",{templateUrl:"canvas_index.html",controller:"CanvasIndexCtrl"}).otherwise({redirectTo:"/"})}]),app.run(["$rootScope","$cookies","$http",function(e,t,n){e.$watch(function(){return t[serverVars.csrfCookieName]},function(){n.defaults.headers.common["X-XSRF-TOKEN"]=t[serverVars.csrfCookieName]})}]),angular.module("Controllers").controller("AuthIndexCtrl",["$scope","UsersServ",function(e,t){e.logout=function(){e.$emit("authenticationDestroy",t.getUserData().id)},e.login=function(){var n={username:e.loginForm.username,password:e.loginForm.password,rememberMe:e.loginForm.rememberMe};e.loginErrors=[],e.validationErrors={},t.loginSession(n,function(){console.log("We are logged in")},function(t){console.log("Login failed, here's the errors."),"validation_error"===t.data.code&&(Array.isArray(t.data.content)?e.loginErrors=t.data.content:e.validationErrors={username:t.data.content.username,password:t.data.content.password,rememberMe:t.data.content.rememberMe})}),e.$on("authenticationProvided",function(){var n=t.getUserData();console.log(n),e.state=!0})}}]),angular.module("Controllers").controller("CanvasIndexCtrl",["$scope","UsersServ",function(){}]),angular.module("Controllers").controller("FooterCtrl",["$scope","httpMessages",function(e,t){e.httpMessages=t}]),angular.module("Controllers").controller("HeaderCtrl",["$scope",function(e){e.testData="Hello World!"}]),angular.module("Controllers").controller("HomeIndexCtrl",["$scope",function(e){e.data="HELLO!"}]),angular.module("Directives").directive("chessCanvasDir",["UtilitiesServ","KineticServ","$timeout",function(e,t){return{scope:!0,link:function(n,o){var r={R:"img/White_Rook.png",N:"img/White_Knight.png",B:"img/White_Bishop.png",Q:"img/White_Queen.png",K:"img/White_King.png",P:"img/White_Pawn.png",r:"img/Black_Rook.png",n:"img/Black_Knight.png",b:"img/Black_Bishop.png",q:"img/Black_Queen.png",k:"img/Black_King.png",p:"img/Black_Pawn.png"};e.canvasPreloadImages(r,function(e){function n(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}var r={},i=new t.Stage({container:o[0],width:480,height:480}),a=new t.Layer,s=function(e,n,o,i,a){var s=new t.Rect({x:e,y:n,width:60,height:60,fill:o,type:i,name:a,identity:"boardSquare",stroke:"",strokeWidth:0});return s.on("mouseenter",function(){r=this}),s},c={},u={},l={},d=480,f=-60;for(u=1;9>u;u++)if(f=-60,d-=60,0!==u%2)for(l=1;9>l;l++)f+=60,0!==l%2?(c=s(f,d,"#638598","black",String.fromCharCode(96+l)+""+u),a.add(c)):(c=s(f,d,"#FFE6CE","white",String.fromCharCode(96+l)+""+u),a.add(c));else for(l=1;9>l;l++)f+=60,0!==l%2?(c=s(f,d,"#FFE6CE","white",String.fromCharCode(96+l)+""+u),a.add(c)):(c=s(f,d,"#638598","black",String.fromCharCode(96+l)+""+u),a.add(c));var g=[["","","","","","","","R"],["","","P","","","P","K",""],["","B","","","Q","N","P",""],["","P","","","P","","",""],["R","","B","N","p","","n",""],["p","","b","","n","","p","p"],["","q","p","","","p","b",""],["r","","","","r","","k",""]],h=function(e,n,o,r,i,a,s,c){var u=new t.Image({x:e,y:n,image:o,width:60,height:60,name:r,identity:"piece",draggable:!0});return u.on("mouseover",i),u.on("mouseout",a),u.on("dragmove",s),u.on("dragend",c),u};document.onselectstart=function(){return!1};var p=function(){document.body.style.cursor="pointer"},m=function(){document.body.style.cursor="default"},v=function(){this.moveUp(),a.draw(),document.body.style.cursor="pointer"},y=function(){};for(d=480,u=1;9>u;u++)for(f=-60,d-=60,l=1;9>l;l++){f+=60;var b=g[u-1][l-1];if(""!==b){var S=h(f,d,e[b],b,p,m,v,y);a.add(S)}}i.add(a);var w=[["a1","b1","c1","d1","e1","f1","g1","h1"],["a2","b2","c2","d2","e2","f2","g2","h2"],["a3","b3","c3","d3","e3","f3","g3","h3"],["a4","b4","c4","d4","e4","f4","g4","h4"],["a5","b5","c5","d5","e5","f5","g5","h5"],["a6","b6","c6","d6","e6","f6","g6","h6"],["a7","b7","c7","d7","e7","f7","g7","h7"],["a8","b8","c8","d8","e8","f8","g8","h8"]],$=60,C=[0,0],k=[],P=[],F=[];for(d=8*$+C[0],u=1;9>u;u++){for(f=-$+C[1],d-=$,P=[],l=1;9>l;l++)f+=$,F=[f,d],P.push(F);k.push(P)}var U={},A={},x={},E={},_={},q={},I={};a.on("mousedown dragmove",function(e){for(E=e.targetNode,E.moveUp(),U=i.getPointerPosition(),u=0;8>u;u++)for(l=0;8>l;l++)U.x>k[u][l][0]&&U.x<=k[u][l][0]+$&&U.y>k[u][l][1]&&U.y<=k[u][l][1]+$&&(A=w[u][l],x=k[u][l]);R(A),q.attrs.name!==A?("white"===q.attrs.type?q.setFill("#FFE6CE"):q.setFill("#638598"),_.setFill("#CA9FB7"),q=_):_.setFill("#CA9FB7")}),a.on("mouseup dragend",function(){E.setPosition(x[0],x[1]),"white"===_.attrs.type?_.setFill("#FFE6CE"):_.setFill("#638598"),D(x),n(I)||I.remove(),a.draw()});var R=function(e){for(u=0;a.children.length>u;u++)a.children[u].attrs.name===e&&(_=a.children[u]);n(q)&&(q=_)},D=function(e){for(u=0;a.children.length>u;u++)a.children[u].attrs.x===e[0]&&a.children[u].attrs.y===e[1]&&"piece"===a.children[u].attrs.identity&&a.children[u]!==E&&(I=a.children[u])}})}}}]),angular.module("Services").factory("AccountsServ",["$resource",function(e){return e("api/accounts/:id",{},{update:{method:"PUT"}})}]),angular.module("Services").config(["$provide","$httpProvider",function(e,t){var n=[];e.value("httpMessages",n),t.responseInterceptors.push(["$q",function(e){return function(t){return t.then(function(e){switch(e.config.method.toUpperCase()){case"GET":n.push({message:"Successfully Received",type:"success"});break;case"POST":n.push({message:"Successfully Posted",type:"success"});break;case"PUT":n.push({message:"Successfully Updated",type:"success"});break;case"DELETE":n.push({message:"Sucessfully Deleted",type:"success"})}return e},function(t){switch(t.status){case 400:n.push({message:"Validation failed, try tweaking your submission.",type:"failure"});break;case 401:n.push({message:"Unauthorised request, try logging in.",type:"failure"});break;case 403:n.push({message:"Unauthorised request, you don't have the permissions to view this.",type:"failure"});break;case 404:n.push({message:"404, sorry could not find what you were looking for.",type:"failure"});break;case 405:n.push({message:"The requested method was incompatible with the requested resource.",type:"failure"});break;case 500:n.push({message:"There was a server error, try again later, or contact the owners.",type:"failure"});break;default:n.push({message:t.status+" General error processing the request",type:"failure"})}return e.reject(t)})}}])}]),angular.module("Services").factory("KineticServ",[function(){return Kinetic}]),angular.module("Services").factory("SessionsServ",["$resource",function(e){return e("api/sessions/:id",{},{update:{method:"PUT"}})}]),angular.module("Services").config(["$httpProvider",function(e){e.responseInterceptors.push(["$q","$rootScope",function(e,t){return function(n){return n.then(function(e){return e},function(n){if(401===n.status||403===n.status){var o=e.defer(),r={config:n.config,deferred:o};return t.$broadcast("authenticationPartial",r),o.promise}return e.reject(n)})}}])}]).provider("UsersServ",function(){var e={},t="",n="/auth",o=!1,r=[];this.setLoginPage=function(e){n=e},this.$get=["$rootScope","$location","$http","AccountsServ","SessionsServ",function(i,a,s,c,u){var l={getUserData:function(){return e},setUserData:function(t){angular.extend(e,t)},registerAccount:function(e,t,n){c.save({},e,function(n){i.$broadcast("authenticationRegister",e),"function"==typeof t&&t(n)},function(e){"function"==typeof n&&n(e)})},deleteAccount:function(e,t,n){c.remove({id:e},function(n){i.$broadcast("authenticationDestroy",e),"function"==typeof t&&t(n)},function(e){"function"==typeof n&&n(e)})},getAccount:function(t,n,o){c.get({id:t},function(t){e=t.content,i.$broadcast("authenticationProvided",e),"function"==typeof n&&n(t)},function(e){"function"==typeof o&&o(e)})},loginSession:function(e,t,n){u.save({},e,function(e){i.$broadcast("authenticationLogin",e.content),"function"==typeof t&&t(e)},function(e){"function"==typeof n&&n(e)})},logoutSession:function(t,n,o){u.remove({id:t},function(t){i.$broadcast("authenticationLogout",t.content),e={},"function"==typeof n&&n(t)},function(e){"function"==typeof o&&o(e)})},getSession:function(e,t,n){u.get({id:e},function(e){e.content.userId!==void 0&&i.$broadcast("authenticationLogin",e.content.userId),"function"==typeof t&&t(e)},function(e){"function"==typeof n&&n(e)})}};return i.$on("authenticationPartial",function(n,i){0===Object.keys(e).length&&(t="",o=!0,r.push(i))}),i.$on("authenticationFull",function(){0===Object.keys(e).length&&(t=a.path,a.path(n))}),i.$on("authenticationRegister",function(e,n){t="/",l.loginSession({username:n.username,password:n.password})}),i.$on("authenticationDestroy",function(e,n){t="/",l.logoutSession(n)}),i.$on("authenticationLogin",function(e,n){l.getAccount(n),t&&(a.path(t),t="");var i=function(e){s(e.config).then(function(t){e.deferred.resolve(t)},function(t){e.deferred.reject(t)})};if(o){for(var c=0;r.length>c;c++)i(r[c]);o=!1,r=[]}}),i.$on("authenticationLogout",function(){t&&(a.path(t),t="")}),l}]}).run(["UsersServ",function(e){e.getSession(0)}]),angular.module("Services").service("UtilitiesServ",["$window","$timeout",function(e,t){this.requestAnimationFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){t(e,1e3/60)}}().bind(e),this.type=function(e){return Object.prototype.toString.call(e).slice(8,-1)},this.canvasPreloadImages=function(e,t){if("Object"!==this.type(e)||"Function"!==this.type(t))return!1;var n={},o=0,r=Object.keys(e).length,i=function(){return function(){++o>=r&&t(n)}};for(var a in e)e.hasOwnProperty(a)&&(n[a]=new Image,n[a].onload=i(),n[a].src=e[a])}}]);